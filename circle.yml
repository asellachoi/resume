## Customize the test machine
machine:
  timezone:
    Asia/Seoul

  services:
    - docker

checkout:
  post:
    - git submodule sync --recursive
    - git submodule update --recursive --init

dependencies:
  pre:
    # to push release files to github
    - go get github.com/tcnksm/ghr
    # to push artifacts to google drive: see, https://joeyrobert.org/2016/07/13/artifact-deployment-via-google-drive/
    - go get github.com/prasmussen/gdrive

## Customize compile commands
test:
  override:
    - docker run --rm -w "/doc" -v "$PWD":/doc thomasweise/texlive make
  post:
    - mv *.pdf $CIRCLE_ARTIFACTS/

deployment:
  release:
    branch: master
    commands:
    # Publish assets to Github
    - ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME v1.0.$CIRCLE_BUILD_NUM $CIRCLE_ARTIFACTS/ || true
    # Publish artifacts to google drive
    - gdrive upload --refresh-token $GDRIVE_REFRESH_TOKEN --parent $GDRIVE_DIR $CIRCLE_ARTIFACTS/*.pdf